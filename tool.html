<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Server Auto Setup Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #5865f2 0%, #7289da 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .auth-section {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }

        .main-content {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            display: none;
        }

        .main-content.active {
            display: block;
        }

        .form-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #5865f2;
        }

        .form-section h3 {
            color: #5865f2;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #5865f2;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #5865f2;
            color: white;
        }

        .btn-primary:hover {
            background: #4752c4;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #43b581;
            color: white;
        }

        .btn-danger {
            background: #f04747;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .discord-login {
            text-align: center;
        }

        .discord-login-btn {
            background: #5865f2;
            color: white;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 10px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(88, 101, 242, 0.3);
        }

        .discord-login-btn:hover {
            background: #4752c4;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(88, 101, 242, 0.4);
        }

        .server-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .server-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .server-card:hover {
            transform: translateY(-5px);
            border-color: #5865f2;
        }

        .server-card.selected {
            border-color: #43b581;
            background: #f0fff4;
        }

        .server-icon {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            margin-bottom: 15px;
            background: #5865f2;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .feature-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e1e5e9;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            background: #ccc;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #5865f2;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active::after {
            transform: translateX(25px);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e1e5e9;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #43b581, #5865f2);
            width: 0%;
            transition: width 0.5s ease;
        }

        .log-container {
            background: #2c2f33;
            color: #dcddde;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            display: none;
        }

        .log-container.active {
            display: block;
        }

        .status {
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .hidden {
            display: none;
        }

        .bot-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .bot-input input {
            flex: 1;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Discord Server Auto Setup</h1>
            <p>T·ª± ƒë·ªông t·∫°o v√† c·∫•u h√¨nh Discord server v·ªõi ƒë·∫ßy ƒë·ªß t√≠nh nƒÉng!</p>
        </div>

        <!-- Authentication Section -->
        <div id="authSection" class="auth-section">
            <h2 style="margin-bottom: 20px; color: #5865f2;">üîê ƒêƒÉng nh·∫≠p Discord</h2>
            
            <div class="status warning">
                <strong>‚ö†Ô∏è Quan tr·ªçng:</strong> Tool n√†y c·∫ßn User Token ƒë·ªÉ c√≥ th·ªÉ t·ª± ƒë·ªông t·∫°o channels/roles. 
                L∆∞u √Ω: S·ª≠ d·ª•ng User Token c√≥ th·ªÉ vi ph·∫°m ToS c·ªßa Discord. Ch·ªâ s·ª≠ d·ª•ng tr√™n server ri√™ng c·ªßa b·∫°n!
            </div>

            <div class="form-group">
                <label for="userToken">Discord User Token:</label>
                <input type="password" id="userToken" placeholder="Paste Discord user token t·∫°i ƒë√¢y...">
                <small style="color: #666; margin-top: 5px; display: block;">
                    C√°ch l·∫•y token: F12 ‚Üí Application ‚Üí Storage ‚Üí Local Storage ‚Üí https://discord.com ‚Üí T√¨m "token"
                </small>
            </div>

            <div class="discord-login">
                <button onclick="connectDiscord()" class="discord-login-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
                    </svg>
                    K·∫øt n·ªëi Discord
                </button>
            </div>

            <div id="connectionStatus" class="hidden"></div>
        </div>

        <!-- Main Setup Interface -->
        <div id="mainContent" class="main-content">
            <!-- Server Selection -->
            <div class="form-section">
                <h3>üè† Ch·ªçn Server ƒë·ªÉ Setup</h3>
                <div id="serverList" class="server-list">
                    <!-- Servers s·∫Ω ƒë∆∞·ª£c load ƒë·ªông -->
                </div>
                <div id="selectedServer" class="hidden">
                    <p>Server ƒë∆∞·ª£c ch·ªçn: <strong id="selectedServerName"></strong></p>
                </div>
            </div>

            <div class="grid">
                <!-- Template Selection -->
                <div class="form-section">
                    <h3>üéØ Ch·ªçn Template</h3>
                    <div class="form-group">
                        <select id="templateSelect">
                            <option value="gaming">üéÆ Gaming Community</option>
                            <option value="community">üí¨ General Community</option>
                            <option value="study">üìö Study Group</option>
                            <option value="business">üíº Business</option>
                            <option value="creative">üé® Creative Hub</option>
                        </select>
                    </div>
                </div>

                <!-- Features -->
                <div class="form-section">
                    <h3>‚öôÔ∏è T√≠nh nƒÉng</h3>
                    <div class="feature-toggle">
                        <span>üîê Verification System</span>
                        <div class="toggle-switch active" data-feature="verification"></div>
                    </div>
                    <div class="feature-toggle">
                        <span>üéÅ Giveaway Channels</span>
                        <div class="toggle-switch active" data-feature="giveaway"></div>
                    </div>
                    <div class="feature-toggle">
                        <span>üõ°Ô∏è Staff Private Area</span>
                        <div class="toggle-switch active" data-feature="staff"></div>
                    </div>
                    <div class="feature-toggle">
                        <span>üîû NSFW Channels</span>
                        <div class="toggle-switch" data-feature="nsfw"></div>
                    </div>
                    <div class="feature-toggle">
                        <span>ü§ñ Bot Channels</span>
                        <div class="toggle-switch active" data-feature="bots"></div>
                    </div>
                </div>
            </div>

            <!-- Bot Configuration -->
            <div class="form-section">
                <h3>ü§ñ C·∫•u h√¨nh Bots</h3>
                <div id="botContainer">
                    <div class="bot-input">
                        <input type="text" placeholder="T√™n bot (vd: MEE6)" class="bot-name" value="MEE6">
                        <button type="button" class="btn btn-danger" onclick="removeBotInput(this)">X√≥a</button>
                    </div>
                </div>
                <button type="button" class="btn btn-success" onclick="addBotInput()">+ Th√™m Bot</button>
            </div>

            <!-- Setup Button -->
            <div style="text-align: center; margin: 30px 0;">
                <button onclick="startAutoSetup()" class="btn btn-primary" style="padding: 15px 40px; font-size: 16px;">
                    üöÄ B·∫Øt ƒë·∫ßu Auto Setup
                </button>
            </div>

            <!-- Progress -->
            <div id="progressSection" class="hidden">
                <h3>üìä Ti·∫øn tr√¨nh Setup</h3>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div id="currentTask">ƒêang chu·∫©n b·ªã...</div>
                <div id="logContainer" class="log-container"></div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let discordToken = '';
        let selectedServerId = '';
        let serverConfig = {
            verification: true,
            giveaway: true,
            staff: true,
            nsfw: false,
            bots: true
        };

        // Discord API Base URL
        const DISCORD_API = 'https://discord.com/api/v10';

        // Initialize toggles
        document.addEventListener('DOMContentLoaded', function() {
            initializeToggles();
        });

        function initializeToggles() {
            document.querySelectorAll('.toggle-switch').forEach(toggle => {
                const feature = toggle.dataset.feature;
                if (serverConfig[feature]) {
                    toggle.classList.add('active');
                }
                
                toggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    serverConfig[feature] = this.classList.contains('active');
                });
            });
        }

        // Connect to Discord
        async function connectDiscord() {
            const token = document.getElementById('userToken').value.trim();
            
            if (!token) {
                showStatus('error', 'Vui l√≤ng nh·∫≠p Discord token!');
                return;
            }

            showStatus('warning', 'ƒêang k·∫øt n·ªëi Discord...');

            try {
                // Test token validity
                const response = await fetch(`${DISCORD_API}/users/@me`, {
                    headers: {
                        'Authorization': token,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Token kh√¥ng h·ª£p l·ªá');
                }

                const user = await response.json();
                discordToken = token;

                showStatus('success', `ƒê√£ k·∫øt n·ªëi th√†nh c√¥ng! Xin ch√†o ${user.username}#${user.discriminator}`);
                
                // Load user's servers
                await loadUserServers();
                
                // Show main content
                document.getElementById('mainContent').classList.add('active');

            } catch (error) {
                console.error('Connection error:', error);
                showStatus('error', `L·ªói k·∫øt n·ªëi: ${error.message}`);
            }
        }

        async function loadUserServers() {
            try {
                const response = await fetch(`${DISCORD_API}/users/@me/guilds`, {
                    headers: {
                        'Authorization': discordToken,
                        'Content-Type': 'application/json'
                    }
                });

                const guilds = await response.json();
                const serverList = document.getElementById('serverList');
                serverList.innerHTML = '';

                // Ch·ªâ hi·ªÉn th·ªã servers m√† user c√≥ quy·ªÅn admin
                const adminServers = guilds.filter(guild => 
                    (guild.permissions & 0x8) === 0x8 || guild.owner
                );

                adminServers.forEach(guild => {
                    const serverCard = document.createElement('div');
                    serverCard.className = 'server-card';
                    serverCard.onclick = () => selectServer(guild.id, guild.name, serverCard);

                    const iconUrl = guild.icon 
                        ? `https://cdn.discordapp.com/icons/${guild.id}/${guild.icon}.png`
                        : null;

                    serverCard.innerHTML = `
                        <div class="server-icon" ${iconUrl ? `style="background-image: url(${iconUrl}); background-size: cover;"` : ''}>
                            ${!iconUrl ? guild.name.charAt(0).toUpperCase() : ''}
                        </div>
                        <h4>${guild.name}</h4>
                        <p>Members: ~${guild.approximate_member_count || 'Unknown'}</p>
                        <small>ID: ${guild.id}</small>
                    `;

                    serverList.appendChild(serverCard);
                });

                if (adminServers.length === 0) {
                    serverList.innerHTML = '<p style="text-align: center; color: #666;">Kh√¥ng t√¨m th·∫•y server n√†o b·∫°n c√≥ quy·ªÅn admin.</p>';
                }

            } catch (error) {
                console.error('Load servers error:', error);
                showStatus('error', 'L·ªói t·∫£i danh s√°ch server');
            }
        }

        function selectServer(serverId, serverName, cardElement) {
            // Remove previous selection
            document.querySelectorAll('.server-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Select current
            cardElement.classList.add('selected');
            selectedServerId = serverId;
            
            document.getElementById('selectedServer').classList.remove('hidden');
            document.getElementById('selectedServerName').textContent = serverName;
        }

        function addBotInput() {
            const container = document.getElementById('botContainer');
            const div = document.createElement('div');
            div.className = 'bot-input';
            div.innerHTML = `
                <input type="text" placeholder="T√™n bot" class="bot-name">
                <button type="button" class="btn btn-danger" onclick="removeBotInput(this)">X√≥a</button>
            `;
            container.appendChild(div);
        }

        function removeBotInput(btn) {
            btn.parentElement.remove();
        }

        function showStatus(type, message) {
            const status = document.getElementById('connectionStatus');
            status.className = `status ${type}`;
            status.textContent = message;
            status.classList.remove('hidden');
        }

        // Main Setup Function
        async function startAutoSetup() {
            if (!selectedServerId) {
                alert('Vui l√≤ng ch·ªçn server tr∆∞·ªõc!');
                return;
            }

            const progressSection = document.getElementById('progressSection');
            const progressFill = document.getElementById('progressFill');
            const currentTask = document.getElementById('currentTask');
            const logContainer = document.getElementById('logContainer');

            progressSection.classList.remove('hidden');
            logContainer.classList.add('active');

            const template = document.getElementById('templateSelect').value;
            const bots = Array.from(document.querySelectorAll('.bot-name'))
                .map(input => input.value.trim())
                .filter(name => name);

            const tasks = [
                'T·∫°o roles c∆° b·∫£n',
                'T·∫°o categories',
                'T·∫°o text channels',
                'T·∫°o voice channels',
                serverConfig.staff ? 'T·∫°o staff area' : null,
                serverConfig.nsfw ? 'T·∫°o NSFW area' : null,
                serverConfig.bots && bots.length > 0 ? 'T·∫°o bot channels' : null,
                serverConfig.verification ? 'Setup verification' : null,
                serverConfig.giveaway ? 'Setup giveaway' : null,
                'Ho√†n t·∫•t c·∫•u h√¨nh'
            ].filter(Boolean);

            let completedTasks = 0;

            function updateProgress(taskName) {
                completedTasks++;
                const progress = (completedTasks / tasks.length) * 100;
                progressFill.style.width = `${progress}%`;
                currentTask.textContent = taskName;
                addLog(`‚úÖ ${taskName}`);
            }

            function addLog(message) {
                logContainer.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}\n`;
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            try {
                addLog('üöÄ B·∫Øt ƒë·∫ßu auto setup server...');

                // 1. T·∫°o Roles
                currentTask.textContent = 'ƒêang t·∫°o roles...';
                await createRoles();
                updateProgress('T·∫°o roles c∆° b·∫£n');

                // 2. T·∫°o Categories v√† Channels theo template
                const templateData = getTemplateData(template);
                
                for (const categoryData of templateData.categories) {
                    currentTask.textContent = `ƒêang t·∫°o category: ${categoryData.name}`;
                    await createCategory(categoryData);
                    updateProgress(`T·∫°o category: ${categoryData.name}`);
                }

                // 3. Staff Area
                if (serverConfig.staff) {
                    currentTask.textContent = 'ƒêang t·∫°o staff area...';
                    await createStaffArea();
                    updateProgress('T·∫°o staff area');
                }

                // 4. NSFW Area
                if (serverConfig.nsfw) {
                    currentTask.textContent = 'ƒêang t·∫°o NSFW area...';
                    await createNSFWArea();
                    updateProgress('T·∫°o NSFW area');
                }

                // 5. Bot Channels
                if (serverConfig.bots && bots.length > 0) {
                    currentTask.textContent = 'ƒêang t·∫°o bot channels...';
                    await createBotChannels(bots);
                    updateProgress('T·∫°o bot channels');
                }

                // 6. Verification
                if (serverConfig.verification) {
                    currentTask.textContent = 'ƒêang setup verification...';
                    await setupVerification();
                    updateProgress('Setup verification');
                }

                // 7. Giveaway
                if (serverConfig.giveaway) {
                    currentTask.textContent = 'ƒêang setup giveaway...';
                    await setupGiveaway();
                    updateProgress('Setup giveaway');
                }

                updateProgress('Ho√†n t·∫•t c·∫•u h√¨nh');
                addLog('üéâ Setup server ho√†n t·∫•t th√†nh c√¥ng!');
                
                showStatus('success', '‚úÖ Server ƒë√£ ƒë∆∞·ª£c setup th√†nh c√¥ng!');

            } catch (error) {
                console.error('Setup error:', error);
                addLog(`‚ùå L·ªói: ${error.message}`);
                showStatus('error', `L·ªói setup: ${error.message}`);
            }
        }

        // API Helper Functions
        async function discordAPI(endpoint, method = 'GET', data = null) {
            const options = {
                method,
                headers: {
                    'Authorization': discordToken,
                    'Content-Type': 'application/json'
                }
            };

            if (data) {
                options.body = JSON.stringify(data);
            }

            const response = await fetch(`${DISCORD_API}${endpoint}`, options);
            
            if (!response.ok) {
                const error = await response.text();
                throw new Error(`API Error: ${response.status} - ${error}`);
            }

            return response.json();
        }

        async function createRoles() {
            const roles = [
                { name: "üëë Owner", color: 16711680, permissions: "8" },
                { name: "‚ö° Administrator", color: 16744192, permissions: "8" },
                { name: "üõ°Ô∏è Moderator", color: 65280, permissions: "268435456" },
                { name: "üîß Staff", color: 49151, permissions: "8192" },
                { name: "üíé Server Booster", color: 16023551, permissions: "0" },
                { name: "‚úÖ Verified", color: 4437377, permissions: "0" },
                { name: "üö´ Muted", color: 7634045, permissions: "0" }
            ];

            for (const roleData of roles) {
                try {
                    await discordAPI(`/guilds/${selectedServerId}/roles`, 'POST', roleData);
                    await sleep(1000); // Rate limit protection
                } catch (error) {
                    console.log(`Role ${roleData.name} c√≥ th·ªÉ ƒë√£ t·ªìn t·∫°i`);
                }
            }
        }

        async function createCategory(categoryData) {
            // T·∫°o category
            const category = await discordAPI(`/guilds/${selectedServerId}/channels`, 'POST', {
                name: categoryData.name,
                type: 4, // Category type
                permission_overwrites: categoryData.private ? [
                    {
                        id: selectedServerId, // @everyone role ID = server ID
                        type: 0,
                        deny: "1024" // VIEW_CHANNEL
                    }
                ] : []
            });

            await sleep(1000);

            // T·∫°o channels trong category
            for (const channelData of categoryData.channels) {
                try {
                    await discordAPI(`/guilds/${selectedServerId}/channels`, 'POST', {
                        name: channelData.name,
                        type: channelData.type === 'voice' ? 2 : 0,
                        parent_id: category.id,
                        topic: channelData.topic || null,
                        nsfw: channelData.nsfw || false
                    });
                    await sleep(800);
                } catch (error) {
                    console.log(`Channel ${channelData.name} error:`, error.message);
                }
            }
        }

        async function createStaffArea() {
            const staffCategory = await discordAPI(`/guilds/${selectedServerId}/channels`, 'POST', {
                name: 'üõ°Ô∏è STAFF AREA',
                type: 4,
                permission_overwrites: [
                    {
                        id: selectedServerId,
                        type: 0,
                        deny: "1024" // VIEW_CHANNEL
                    }
                ]
            });

            await sleep(1000);

            const staffChannels = [
                { name: 'üëëowner-only', topic: 'Ch·ªâ d√†nh cho owner' },
                { name: '‚ö°admin-chat', topic: 'Chat ri√™ng admin' },
                { name: 'üõ°Ô∏èmod-chat', topic: 'Chat ri√™ng moderator' },
                { name: 'üîßstaff-general', topic: 'Chat chung staff' },
                { name: 'üìäreports-logs', topic: 'Reports v√† logs' }
            ];

            for (const channelData of staffChannels) {
                await discordAPI(`/guilds/${selectedServerId}/channels`, 'POST', {
                    name: channelData.name,
                    type: 0,
                    parent_id: staffCategory.id,
                    topic: channelData.topic,
                    permission_overwrites: [
                        {
                            id: selectedServerId,
                            type: 0,
                            deny: "1024"
                        }
                    ]
                });
                await sleep(800);
            }
        }

        async function createNSFWArea() {
            const nsfwCategory = await discordAPI(`/guilds/${selectedServerId}/channels`, 'POST', {
                name: 'üîû NSFW (18+)',
                type: 4
            });

            await sleep(1000);

            const nsfwChannels = [
                { name: 'üîûnsfw-general', topic: 'NSFW general chat' },
                { name: 'üîûnsfw-media', topic: 'NSFW media sharing' }
            ];

            for (const channelData of nsfwChannels) {
                await discordAPI(`/guilds/${selectedServerId}/channels`, 'POST', {
                    name: channelData.name,
                    type: 0,
                    parent_id: nsfwCategory.id,
                    topic: channelData.topic,
                    nsfw: true
                });
                await sleep(800);
            }
        }

        async function createBotChannels(bots) {
            const botCategory = await discordAPI(`/guilds/${selectedServerId}/channels`, 'POST', {
                name: 'ü§ñ BOT CHANNELS',
                type: 4
            });

            await sleep(1000);

            for (const botName of bots) {
                await discordAPI(`/guilds/${selectedServerId}/channels`, 'POST', {
                    name: `ü§ñ${botName.toLowerCase()}-commands`,
                    type: 0,
                    parent_id: botCategory.id,
                    topic: `Commands cho ${botName} bot`
                });
                await sleep(800);
            }
        }

        async function setupVerification() {
            const verifyChannel = await discordAPI(`/guilds/${selectedServerId}/channels`, 'POST', {
                name: '‚úÖverification',
                type: 0,
                topic: 'Verify ƒë·ªÉ truy c·∫≠p server',
                permission_overwrites: [
                    {
                        id: selectedServerId,
                        type: 0,
                        allow: "1024", // VIEW_CHANNEL
                        deny: "2048"   // SEND_MESSAGES
                    }
                ]
            });

            await sleep(1000);

            // G·ª≠i verification message
            const embed = {
                title: 'üîê Verification Required',
                description: `Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi server!\n\n1Ô∏è‚É£ ƒê·ªçc k·ªπ rules\n2Ô∏è‚É£ React ‚úÖ ƒë·ªÉ verify\n3Ô∏è‚É£ Enjoy server!`,
                color: 4437377,
                thumbnail: {
                    url: 'https://cdn.discordapp.com/emojis/742737352075325571.png'
                }
            };

            await discordAPI(`/channels/${verifyChannel.id}/messages`, 'POST', {
                embeds: [embed]
            });
        }

        async function setupGiveaway() {
            const giveawayCategory = await discordAPI(`/guilds/${selectedServerId}/channels`, 'POST', {
                name: 'üéÅ GIVEAWAY & EVENTS',
                type: 4
            });

            await sleep(1000);

            const channels = [
                { name: 'üéÅgiveaways', topic: 'Tham gia giveaway t·∫°i ƒë√¢y!' },
                { name: 'üéäevent-chat', topic: 'Chat v·ªÅ events' }
            ];

            for (const channelData of channels) {
                await discordAPI(`/guilds/${selectedServerId}/channels`, 'POST', {
                    name: channelData.name,
                    type: 0,
                    parent_id: giveawayCategory.id,
                    topic: channelData.topic
                });
                await sleep(800);
            }

            // T·∫°o Giveaway role
            await discordAPI(`/guilds/${selectedServerId}/roles`, 'POST', {
                name: 'üéÅ Giveaway Ping',
                color: 16766720, // Gold color
                mentionable: true
            });
        }

        function getTemplateData(template) {
            const templates = {
                gaming: {
                    categories: [
                        {
                            name: "üìñ TH√îNG TIN CHUNG",
                            channels: [
                                { name: "üö™welcome", type: "text", topic: "Ch√†o m·ª´ng th√†nh vi√™n m·ªõi" },
                                { name: "üìãrules-and-info", type: "text", topic: "Quy t·∫Øc v√† th√¥ng tin server" },
                                { name: "üì¢announcements", type: "text", topic: "Th√¥ng b√°o quan tr·ªçng" },
                                { name: "üéâevents", type: "text", topic: "S·ª± ki·ªán v√† ho·∫°t ƒë·ªông" }
                            ]
                        },
                        {
                            name: "üí¨ CHAT CH√çNH",
                            channels: [
                                { name: "üí≠general-chat", type: "text", topic: "Chat chung" },
                                { name: "üéÆgaming-talk", type: "text", topic: "Th·∫£o lu·∫≠n v·ªÅ game" },
                                { name: "üñºÔ∏èmedia-share", type: "text", topic: "Chia s·∫ª h√¨nh ·∫£nh, video" },
                                { name: "ü§ñbot-commands", type: "text", topic: "L·ªánh bot chung" }
                            ]
                        },
                        {
                            name: "üîä VOICE CHANNELS",
                            channels: [
                                { name: "üéµMusic Room", type: "voice" },
                                { name: "üéÆGaming Voice 1", type: "voice" },
                                { name: "üéÆGaming Voice 2", type: "voice" },
                                { name: "üí¨General Voice", type: "voice" },
                                { name: "üîíPrivate Room", type: "voice" }
                            ]
                        }
                    ]
                },
                community: {
                    categories: [
                        {
                            name: "üìñ TH√îNG TIN",
                            channels: [
                                { name: "üö™welcome", type: "text" },
                                { name: "üìãrules", type: "text" },
                                { name: "üì¢announcements", type: "text" }
                            ]
                        },
                        {
                            name: "üí¨ CHAT",
                            channels: [
                                { name: "üí≠general", type: "text" },
                                { name: "üó£Ô∏èdiscussion", type: "text" },
                                { name: "üñºÔ∏èmedia", type: "text" }
                            ]
                        },
                        {
                            name: "üîä VOICE",
                            channels: [
                                { name: "üí¨General Voice", type: "voice" },
                                { name: "üéµMusic", type: "voice" }
                            ]
                        }
                    ]
                },
                study: {
                    categories: [
                        {
                            name: "üìö H·ªåC T·∫¨P",
                            channels: [
                                { name: "üìñstudy-general", type: "text" },
                                { name: "‚ùìhomework-help", type: "text" },
                                { name: "üìùnotes-sharing", type: "text" },
                                { name: "üß†study-group", type: "voice" }
                            ]
                        }
                    ]
                },
                business: {
                    categories: [
                        {
                            name: "üíº BUSINESS",
                            channels: [
                                { name: "üíºgeneral-business", type: "text" },
                                { name: "üìämeetings", type: "voice" },
                                { name: "üìãproject-updates", type: "text" }
                            ]
                        }
                    ]
                },
                creative: {
                    categories: [
                        {
                            name: "üé® CREATIVE",
                            channels: [
                                { name: "üé®artwork-showcase", type: "text" },
                                { name: "üé≠creative-chat", type: "text" },
                                { name: "üéµmusic-creation", type: "voice" }
                            ]
                        }
                    ]
                }
            };

            return templates[template] || templates.gaming;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Advanced Features

        // Auto-setup welcome messages
        async function setupWelcomeMessage() {
            try {
                // T√¨m welcome channel
                const channels = await discordAPI(`/guilds/${selectedServerId}/channels`);
                const welcomeChannel = channels.find(ch => ch.name.includes('welcome'));
                
                if (welcomeChannel) {
                    const embed = {
                        title: `üéâ Ch√†o m·ª´ng ƒë·∫øn v·ªõi server!`,
                        description: `C·∫£m ∆°n b·∫°n ƒë√£ tham gia! ƒê·ª´ng qu√™n ƒë·ªçc rules v√† verify nh√©!`,
                        color: 65280,
                        fields: [
                            { name: 'üìã Rules', value: 'ƒê·ªçc k·ªπ tr∆∞·ªõc khi chat', inline: true },
                            { name: '‚úÖ Verify', value: 'Verify ƒë·ªÉ truy c·∫≠p ƒë·∫ßy ƒë·ªß', inline: true },
                            { name: 'üéÅ Events', value: 'Theo d√µi events th∆∞·ªùng xuy√™n', inline: true }
                        ]
                    };

                    await discordAPI(`/channels/${welcomeChannel.id}/messages`, 'POST', {
                        embeds: [embed]
                    });
                }
            } catch (error) {
                console.log('Welcome message error:', error);
            }
        }

        // Quick Setup Buttons
        function showQuickSetup() {
            const quickButtons = document.createElement('div');
            quickButtons.innerHTML = `
                <div class="form-section">
                    <h3>‚ö° Quick Setup</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="quickSetup('gaming')" class="btn btn-primary">üéÆ Gaming Server</button>
                        <button onclick="quickSetup('community')" class="btn btn-primary">üí¨ Community</button>
                        <button onclick="quickSetup('study')" class="btn btn-primary">üìö Study Group</button>
                        <button onclick="quickSetup('full')" class="btn btn-success">üöÄ Full Features</button>
                    </div>
                </div>
            `;
            document.getElementById('mainContent').prepend(quickButtons);
        }

        async function quickSetup(type) {
            if (!selectedServerId) {
                alert('Vui l√≤ng ch·ªçn server tr∆∞·ªõc!');
                return;
            }

            // Set config based on type
            switch (type) {
                case 'gaming':
                    serverConfig = { verification: true, giveaway: true, staff: true, nsfw: false, bots: true };
                    document.getElementById('templateSelect').value = 'gaming';
                    break;
                case 'community':
                    serverConfig = { verification: true, giveaway: false, staff: true, nsfw: false, bots: false };
                    document.getElementById('templateSelect').value = 'community';
                    break;
                case 'study':
                    serverConfig = { verification: true, giveaway: false, staff: true, nsfw: false, bots: false };
                    document.getElementById('templateSelect').value = 'study';
                    break;
                case 'full':
                    serverConfig = { verification: true, giveaway: true, staff: true, nsfw: true, bots: true };
                    break;
            }

            // Update toggles
            Object.keys(serverConfig).forEach(feature => {
                const toggle = document.querySelector(`[data-feature="${feature}"]`);
                if (toggle) {
                    toggle.classList.toggle('active', serverConfig[feature]);
                }
            });

            await startAutoSetup();
        }

        // Enhanced error handling
        window.addEventListener('unhandledrejection', event => {
            console.error('Unhandled promise rejection:', event.reason);
            showStatus('error', 'C√≥ l·ªói kh√¥ng mong mu·ªën x·∫£y ra');
        });

        // Rate limiting helper
        class RateLimiter {
            constructor() {
                this.queue = [];
                this.processing = false;
            }

            async add(fn) {
                return new Promise((resolve, reject) => {
                    this.queue.push({ fn, resolve, reject });
                    this.process();
                });
            }

            async process() {
                if (this.processing || this.queue.length === 0) return;
                
                this.processing = true;
                
                while (this.queue.length > 0) {
                    const { fn, resolve, reject } = this.queue.shift();
                    try {
                        const result = await fn();
                        resolve(result);
                    } catch (error) {
                        reject(error);
                    }
                    await sleep(1200); // Discord rate limit protection
                }
                
                this.processing = false;
            }
        }

        const rateLimiter = new RateLimiter();

        // Enhanced Discord API with rate limiting
        async function discordAPIRateLimited(endpoint, method = 'GET', data = null) {
            return rateLimiter.add(() => discordAPI(endpoint, method, data));
        }

        // Backup v√† restore functions
        async function exportServerConfig() {
            try {
                const channels = await discordAPI(`/guilds/${selectedServerId}/channels`);
                const roles = await discordAPI(`/guilds/${selectedServerId}/roles`);
                const guild = await discordAPI(`/guilds/${selectedServerId}`);

                const config = {
                    serverName: guild.name,
                    exportDate: new Date().toISOString(),
                    channels: channels.map(ch => ({
                        name: ch.name,
                        type: ch.type,
                        parent: ch.parent_id,
                        topic: ch.topic,
                        nsfw: ch.nsfw
                    })),
                    roles: roles.map(role => ({
                        name: role.name,
                        color: role.color,
                        permissions: role.permissions
                    }))
                };

                // Download as JSON
                const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${guild.name}_config_${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);

                showStatus('success', 'Config ƒë√£ ƒë∆∞·ª£c export th√†nh c√¥ng!');
            } catch (error) {
                showStatus('error', `L·ªói export: ${error.message}`);
            }
        }

        // Initialize quick setup after auth
        async function initializeAfterAuth() {
            showQuickSetup();
            
            // Add export button
            const exportBtn = document.createElement('button');
            exportBtn.textContent = 'üíæ Export Server Config';
            exportBtn.className = 'btn btn-secondary';
            exportBtn.onclick = exportServerConfig;
            exportBtn.style.margin = '20px 0';
            document.getElementById('mainContent').appendChild(exportBtn);
        }

        // Call after successful connection
        async function onSuccessfulConnection() {
            await loadUserServers();
            initializeAfterAuth();
            document.getElementById('mainContent').classList.add('active');
        }

        // Update the connectDiscord function
        async function connectDiscord() {
            const token = document.getElementById('userToken').value.trim();
            
            if (!token) {
                showStatus('error', 'Vui l√≤ng nh·∫≠p Discord token!');
                return;
            }

            showStatus('warning', 'ƒêang k·∫øt n·ªëi Discord...');

            try {
                const response = await fetch(`${DISCORD_API}/users/@me`, {
                    headers: {
                        'Authorization': token,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Token kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n');
                }

                const user = await response.json();
                discordToken = token;

                showStatus('success', `‚úÖ K·∫øt n·ªëi th√†nh c√¥ng! Xin ch√†o ${user.username}`);
                
                await onSuccessfulConnection();

            } catch (error) {
                console.error('Connection error:', error);
                showStatus('error', `‚ùå L·ªói k·∫øt n·ªëi: ${error.message}`);
            }
        }

        // Enhanced logging
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logContainer.innerHTML += `[${timestamp}] ${icon} ${message}\n`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Auto-save progress
        function saveProgress() {
            const progress = {
                selectedServerId,
                serverConfig,
                timestamp: Date.now()
            };
            // Would use localStorage here but it's not supported in Claude artifacts
            console.log('Progress saved:', progress);
        }

        // Cleanup and final setup
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Discord Auto Setup Tool initialized');
            
            // Add some default bots
            const defaultBots = ['Carl-bot', 'Dyno'];
            defaultBots.forEach((bot, index) => {
                if (index > 0) addBotInput();
                document.querySelectorAll('.bot-name')[index].value = bot;
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                if (selectedServerId) {
                    startAutoSetup();
                } else if (discordToken) {
                    // Focus server selection
                    document.querySelector('.server-card')?.focus();
                } else {
                    document.getElementById('userToken').focus();
                }
            }
        });
    </script>
</body>
</html>